<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   <title>Home</title>
   <meta name="author" content="Nick Cox" />
   <link href="http://feeds.feedburner.com/" rel="alternate" title="your title" type="application/atom+xml" />

   <!-- syntax highlighting CSS -->
   <link rel="stylesheet" href="/css/syntax.css" type="text/css" />

   <!-- Homepage CSS -->
   <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />


   <link href='/assets/global-8ccd020c9629b2e2d78674c313ab375b.css' rel='stylesheet' type='text/css' media='screen' />


   <!-- jquery -->
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
  
   <script src='/assets/global-b65e50b592150a178c696f69e567eab9.js' type='text/javascript'></script>


   <!-- Typekit -->
   <script type="text/javascript" src="//use.typekit.net/mpf1cec.js"></script>
   <script type="text/javascript">try{Typekit.load();}catch(e){}</script>

   <!-- HTML5 Shim -->
   <!--[if IE]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
   <![endif]-->
 
</head>
<body>

  <div class="site">
    <nav>
      <ul>
        <li><a href="/">Home</a></li>
        <li><a class="extra" href="/archive.html">Archive</a></li>
        <li><a class="extra" href="/pages/about">About</a></li>
      </ul>
    </nav>

    <article>
  
      <article>

  
      <h1>articles</h1>
      <p class="meta">11 May 2013</p>
       
<p>I’ve finally gotten around to putting my recent talk on Triaging Rails Issues on <a href="https://speakerdeck.com/thenickcox/triaging-rails-issues">my speakerdeck page</a>. The slides are extremely terse, though, and it will probably be easier to follow by watching the video of my talk, embedded here. (Thanks to <a href="http://kiwiupover.com">Dave Laird</a> for the video!)</p>

<iframe width="560" height="315" src="http://www.youtube.com/embed/5W2i9xwLufo?rel=0"> </iframe>

  
      <h1>CoffeeScript Wishlist</h1>
      <p class="meta">21 Feb 2013</p>
       
<p>I&#8217;ve been working a bit with CoffeeScript lately, and I&#8217;ve pretty much fallen in love. But as a Rubyist, I find that I miss a few things. Allow me to explain. </p>

<p>Over the Christmas holiday, I found a GitHub project called <a href="http://githubfantasy.com/">Github Fantasy League</a>, which cleverly quantifies a GitHub user&#8217;s open source &#8220;score&#8221; by assigning point values to certain activities, such as creating a pull request or filing an issue. The project is written in CoffeeScript, and I decided I would find something to fix so I could work in the CoffeeScript file and file a <a href="https://github.com/jwright/github-fantasy-league/pull/2">pull request</a>. My change was modest; I decided that the form needed validation. So I spent some time looking over the CoffeeScript syntax, and I rewrote one particular function thusly:</p>

<h3 id="original">Original</h3>

<pre><code>$('#username').bind('keypress', (e) =&gt;	  	
  if (e.keyCode == 13 )	
    $('.score-trigger').click()
)
</code></pre>

<h3 id="my-edit">My Edit</h3>

<pre><code>$('#username').bind('keypress', (e) =&gt;	  	
  $('.score-trigger').click() if e.keyCode == 13)
</code></pre>

<p>This was a few months ago, and I now realize I could&#8217;ve made it still more simple:</p>

<pre><code>$('#username').bind('keypress', (e) =&gt;	  	
  $('.score-trigger').click() if e.keyCode is 13)
</code></pre>

<p>The elegance of that line asounded me, and it reads like natural English: &#8220;The score-trigger element [should receive a] click if the keyCode is 13.&#8221; That, to me, is the hallmark of a great language: readable syntax. </p>

<h2 id="wish-list">Wish List</h2>

<p>But while I love so much about CoffeeScript, a few things don&#8217;t quite make sense to me. For example, it uses Ruby&#8217;s <code>unless</code> keyword, but still prefer&#8217;s JavaScript&#8217;s native <code>else if</code> conditional for control flow to Ruby&#8217;s <code>elsif</code>. Now, I suppose this is a matter of personal preference. That is, <code>elsif</code> isn&#8217;t a word, where as <code>else if</code> is proper English. But I feel like if CoffeeScript is going to adopt certain Ruby idioms, it should be done uniformly. Thus, I&#8217;d prefer to use <code>elsif</code>. </p>

<p>The second thing I&#8217;d like is a ternary operator. I try not to overuse this expression, but if a bit of logic can be placed on one line with the use of a ternary operator, I often prefer it. Consider a simple function to check whether a number is even or odd:</p>

<pre><code>isEven = (number) -&gt;
  if number % 2 is 0
    true
  else 
    false
</code></pre>

<p>This is the pefect case for a ternary operator:</p>

<pre><code>isEven = (number) -&gt;
  number % 2 == 0 ? true : false 
#=&gt; not correct CoffeeScript 
</code></pre>

<p>I suppose you could argue that writing the function that way is too terse. But stylistically speaking, having a single word on a line bothers me. It&#8217;s inefficient and could be cleaned up. But I suppose that&#8217;s a matter of personal preference.</p>

<h2 id="conclusion">Conclusion</h2>

<p>I&#8217;ve very much enjoyed the little CoffeeScript I&#8217;ve done, and I look forward to more complex projects in the near future. However, I do wish that it had the <code>elsif</code> construction (or even supported either <code>else if</code> or <code>elsif</code> just like it supports <code>==</code> or <code>is</code>) and supported the ternary operator. I imagine I&#8217;ll find more as I continue to dive into the language.</p>

<p>What features do you wish CoffeeScript had?</p>


  
      <h1>Special Characters in Vim</h1>
      <p class="meta">30 Jan 2013</p>
       
<p>It took me two or three false starts to really get working in Vim. I loved <a href="http://www.sublimetext.com/2">Sublime Text</a> so much that it was hard to switch. But when I would watch my coworker type at dizzyingly fast speeds, I knew that I would have to make the switch to Vim in order to maximize my efficiency at work.</p>

<p>It has mostly been a great ride, but once in a while, Vim gets weird or wonky. Today, I had a problem that a good deal of Google searching didn&#8217;t seem to want to fix, so I stumbled on a solution I thought I&#8217;d share in case anyone else is pulling their hair out.</p>

<p>I was working in Sublime (don&#8217;t ask) reworking some HTML markup on a particular page, and I had decided to convert it to HAML for inclusion in our app at work. I used the <a href="https://github.com/haml/html2haml">html2haml gem</a> to convert it, and when I opened it up in Vim, I saw a number of special characters that looked like this: <code>&lt;200b&gt;</code>. They were all over, littering the document. I didn&#8217;t want to try to remove them by hand, but trying to find and replace them with an empty string didn&#8217;t work, because Vim wouldn&#8217;t let me search for <code>&lt;200b&gt;</code>. </p>

<p>I did some searching, and found out that this character is the <a href="http://en.wikipedia.org/wiki/Zero-width_space">zero-width space</a>. This oxymoronically named unicode character is, I gather, the equivalent of the <code>&amp;nbsp;</code> HTML entity in that, to quote Wikipedia, &#8220;In HTML pages, this space can be used as a potential line-break in long words.&#8221;</p>

<p>Well, whatever it is, I had to switch Vim to utf-8 mode (<code>:set encoding=utf8</code>). That enabled me to search for <code>&lt;200b&gt;</code>. After that, it was simply a matter of finding and replacing: <code>:%s/&lt;200b&gt;///g</code>. You&#8217;re probably familiar with that syntax, but let&#8217;s break it down. <code>:%s/old_string/new_string/options</code>. That is, <code>:</code> puts Vim into execute mode, <code>%s/</code> tells it you&#8217;re going to search, <code>&lt;200b&gt;</code> is the search string, and we&#8217;re replacing it with nothing, hence the next two slashes: <code>//</code>, and the <code>g</code> flag stands for global, in other words, do this throughout the file.</p>

<p>Note that, in order to include <code>&lt;200b&gt;</code> in the string search, I had to physically highlight it with my mouse and copy paste it into the search; yanking or using visual mode did not work.</p>

<p>I hope that was able to save someone a headache. </p>

  
      <h1>Method Aliases In Ruby</h1>
      <p class="meta">18 Dec 2012</p>
       
<p>I often find myself wondering why so many of the Ruby native string and array methods have aliases. For example, with string methods, we have <code>next</code> and <code>succ</code>, which are equivalent; they both return the next alphanumeric character. Like so:</p>

<pre><code>1.9.3p194 :024 &gt; string = "a"
 =&gt; "a" 
1.9.3p194 :025 &gt; string.next
 =&gt; "b" 
1.9.3p194 :026 &gt; string
 =&gt; "a" 
1.9.3p194 :027 &gt; string.succ
 =&gt; "b"   
</code></pre>

<p>So why do we need both? Here is another example. <code>length</code> and <code>size</code> are also synonymous. Both return the character length of a string.</p>

<pre><code>1.9.3p194 :028 &gt; a = "supercalifragilisticexpealidocious"
 =&gt; "supercalifragilisticexpealidocious" 
1.9.3p194 :029 &gt; a.size
 =&gt; 34 
1.9.3p194 :030 &gt; a.length
 =&gt; 34 
</code></pre>

<p>This is perplexing to me. As much as I love Ruby, I often think that my mind philosophically prefers Python’s approach. The following is a direct quote from <a href="http://www.python.org/dev/peps/pep-0020/">‘The Zen of Python’</a>:</p>

<blockquote>
  <p>There should be one—and preferably only one—obvious
way to do anything.</p>
</blockquote>

<p>I don’t necessarily have an answer (other than the likelihood that one or the other will be more familiar to programmers coming from other languages), but here’s a thought. We’re not working in Python, so let’s embrace the fact that Ruby has two ways of doing things sometimes.</p>

<p>If we think intuitively, it seems to me that we would want to find the ‘size’ of an alphanumeric string like, for instance, a base 64 token. That, to me, makes more intuitive sense than to get the ‘length’ of it. <code>length</code>, to me, seems to be the method we would want to use to find the length of a word, where the word ‘size’ (and method of the same name) don’t make as much lexical sense.</p>

<p>For example:</p>

<pre><code>1.9.3p194 :018 &gt; token = SecureRandom.urlsafe_base64
 =&gt; "OFiTxLeCuosWXiLe9nVLeQ" 
1.9.3p194 :019 &gt; token.size
 =&gt; 22 
</code></pre>

<p>Compare that to this:</p>

<pre><code>1.9.3p194 :022 &gt; sentence = "An incredibly long sentence about whosits and whatsits"
 =&gt; "An incredibly long sentence about whosits and whatsits" 
1.9.3p194 :023 &gt; sentence.length
 =&gt; 54  
</code></pre>

<p>Doesn’t that just make more sense? To me, it seems more expressive.</p>

<p>Just to reiterate, whereas a developer coming from Python might be tempted to use one or the other method uniformly throughout a project, I like to think that Ruby’s features lend themselves well to expressiveness, and I would prefer using one method or the other in the context it makes sense. After all, we work in a language with this syntax:</p>

<pre><code>3.times do 'Hello World!'
</code></pre>

<p>This is as close to spoken English as I’ve ever seen programming syntax. So let’s write Ruby like we would speak, and use methods where they make sense contextually, even if they do the same thing. As a result, our code will be eaiser to read, and therefore maintain. That’s why we have the canonical saying:</p>

<blockquote>
  <p>‘Programs must be written for people to read, and only incidentally for machines to execute.’
- H. Abelson and G. Sussman <em>“The Structure and Interpretation of Computer Programs)</em></p>
</blockquote>

<p>That sounds good, but let’s make this a little bit more complex. Look what happens when we make our string an array. <code>size</code> and <code>length</code> still apply, but to count the number of items in an array we also have, you guessed it, <code>count</code>. Check this out:</p>

<pre><code>1.9.3p194 :017 &gt; sentence = "An incredibly long sentence about whosits and whatsits"
 =&gt; "An incredibly long sentence about whosits and whatsits" 
1.9.3p194 :018 &gt; a = sentence.split(' ')
 =&gt; ["An", "incredibly", "long", "sentence", "about", "whosits", "and", "whatsits"] 
1.9.3p194 :019 &gt; a.size
 =&gt; 8 
1.9.3p194 :020 &gt; a.length
 =&gt; 8 
1.9.3p194 :021 &gt; a.count
 =&gt; 8 
</code></pre>

<p>So when should we use which? According to the <a href="http://www.ruby-doc.org/core-1.9.3/Array.html#method-i-length">Ruby docs</a>, <code>size</code> and <code>length</code> are truly the same, but <code>count</code> can take a block, and will return the number array items that give a true value. So let’s look at our previous example with this in mind:</p>

<pre><code>1.9.3p194 :027 &gt; a
 =&gt; ["An", "incredibly", "long", "sentence", "about", "whosits", "and", "whatsits"] 
1.9.3p194 :028 &gt; a.count
 =&gt; 8 
1.9.3p194 :029 &gt; a.count('long')
 =&gt; 1 
1.9.3p194 :030 &gt; a.count('hello')
 =&gt; 0 
</code></pre>

<p>So while <code>count</code> can return the number of array elements, it also has this added feature of <code>count</code>ing the number of passed in items the array elements match. </p>

<p>Thus, the only rule I can think of when working with arrays is to choose <code>size</code> or <code>length</code> and work with it throughout a project to return the number of array items, but only use <code>count</code> when you need to pass in a block so that there is no confusion about why you used differerent methods in different places to do the same job. This will lend to more cohesion and more expressiveness.</p>

<h2 id="gotchas">Gotchas</h2>

<p>There are, of course, some gotchas to this idea. When I first started writing Ruby, I was so in love with the English-like syntax that, for a time, I decided I wanted to use words instead of symbols for conditional operators. Thus, I might’ve at one point been prone to write:</p>

<pre><code>def greeting
  if user.logged_in? and not(user.nil?)
    "Welcome back, #{user.name}"
  end
end
</code></pre>

<p>That was a contrived example, for sure, and an exaggeration, but I wanted to get to this point: While researching the logical operators, I found a <a href="http://blog.internautdesign.com/2007/5/30/ruby-operator-precedence-gotcha-logical-and">case</a> where <code>and</code> and <code>&amp;&amp;</code> returned different values: </p>

<pre><code>1.9.3p194 :013 &gt; result = true and false; result
 =&gt; true 
1.9.3p194 :014 &gt; result = true &amp;&amp; false; result
 =&gt; false
</code></pre>

<p>That scared me enough to make me want to use symbolic logical operators all the time and sometimes parenthesis just to communicate intent. I now do this even when not strictly necessary:</p>

<pre><code>def viewable_by?(current_user)
  current_user.system_admin? || ( current_user.logged_in? &amp;&amp; current_user.owner? )
end
</code></pre>

<p>In this case, the parenthesis weren’t absolutely necessary, as can be seen when we boil this example down:</p>

<pre><code>1.9.3p194 :024 &gt; false || true &amp;&amp; true
 =&gt; true
</code></pre>

<p>But I use parenthesis anyway. I don’t sacrifice the aesthetics of the code (in my opinion, anyway), and that way, my code intentions become immediately more clear. And isn’t that the goal?</p>


  
      <h1>Refactoring Cucumber</h1>
      <p class="meta">17 Dec 2012</p>
       
<p>At work, we&#8217;ve been moving away from Cucumber tests for the past number of months, in favor of the more robust Capybara and rspec paring. Given that I&#8217;m a relative novice in Rails test-driven development, the supposed brittleness of Cucumber tests wasn&#8217;t immediately clear to me, so I did some digging, and came up with a <a href="http://aslakhellesoy.com/post/11055981222/the-training-wheels-came-off">few</a> <a href="http://benmabey.com/2008/05/19/imperative-vs-declarative-scenarios-in-user-stories.html">posts</a> that talk about the pitfalls of the &#8220;imperative&#8221; style of step writing for user stories. A solid example of this is Ben Mabey&#8217;s ancient, but still applicable post, <a href="http://benmabey.com/2008/05/19/imperative-vs-declarative-scenarios-in-user-stories.html">&#8220;Imperative vs. Declarative Scenarios in User Stories&#8221;</a>. 
Mabey&#8217;s assertion is that it is too easy to rely too heavily on the built-in Cucumber web steps. For example: </p>

<pre><code>When I fill in Name with 'Alligator'
And select Phylum as 'Chordata'
And fill in Animal Class with 'Sauropsida'
And fill in Order with 'Crocodilia'
And fill in Family with 'Alligatoridae'
And fill in Genus with 'Alligator'
And check Lay Eggs
And click the Create button
</code></pre>

<p>Here, Maybe suggests, the &#8220;story&#8221; part of the user story tends to get lost and mired in the technical details.
I was heavily influenced by this post, and decided to do a little Cucumber refactoring at work to try out Mabey&#8217;s declarative style, which he demonstrates thusly:</p>

<pre><code>	Story: Animal Submission
  		As a Zoologist
  		I want to add a new animal to the site
  		So that I can share my animal knowledge with the community
  		
		Scenario: successful submission
  			Given I'm on the animal creation page
  			When I add a new animal
  			Then I should see the page for my newly created animal
  			And the notice 'Thank you for your animal submission!'
</code></pre>

<p>As Mabey notes, it has more of the <a href="http://www.jbrains.ca/permalink/user-stories-a-ticket-for-a-conversation">token for conversation</a> feel to it, and it&#8217;s immediately clear that it is more likely to meet the user&#8217;s need, since, in this case, the user cares more about completing their goals than how those goals are handled on the back end.</p>

<h2 id="my-attempt">My Attempt</h2>

<p>I took Mabey&#8217;s advice to our own codebase, and I extracted a Cucumber test that I had written a few months back. Now, I won&#8217;t start to bad mouth my code and talk endlessly about how terrible a person I am for having written it this way, but I&#8217;ll give you a taste of how poorly this test spoke to the user&#8217;s need. I present to you this feature test for our site&#8217;s feedback form:</p>

<pre><code>	#features/feedback.feature
  	Feature: Feedback
  	Scenario: Submitting feedback
	Given I go to the feedback page
	And I fill out the feedback form and submit it	
	Then I should see a success message
	Then I should see "Email can't be blank"
	When I fill in "Your email" with "nick@navigatingcancer.com"
	And I fill in "Summary" with "This site rules"
	And I fill in "What you observed" with "This site rules"
	And I press "Send"
	Then the flash notice should be "Thank you for your feedback! |
		We try to respond to questions and requests within one business day."
	And ruby FeedbackForm.last.email.should == 'nick@navigatingcancer.com'
	And ruby FeedbackForm.last.content.should match "This site rules"
</code></pre>

<p>Yep, you read that right. That&#8217;s a Ruby function inside of a Cucumber test. I wonder what user will be thinking of their form submission in terms of a Ruby method chain? 
Now here&#8217;s my improved version, written with Turnip and Capybara. </p>

<pre><code>#spec/acceptance/forms/feedback.feature'
Feature: Feedback form
  	
	As a user of the site
  	I want to be able to submit feedback about the site
  	So that I can report if something breaks
  
	@feedback
  	Scenario: Submitting feedback (successful)
	Given I go to the feedback page
	And I fill out the feedback form and submit it
	Then I should see a success message
</code></pre>

  	#spec/acceptance/forms/feedback_steps.rb
  	require &#8216;spec_helper&#8217;
  	steps_for :feedback do
<pre><code>	step 'I go to the feedback page' do
  	page.visit '/feedback'
	end

		step 'I fill out the feedback form and submit it' do
 		page.click_button 'Send'
 		page.should have_content "Email can't be blank"
 		page.fill_in 'Your email', with: 'joe@navigatingcancer.com'
 		page.fill_in 'Summary', with: 'Just saying'      		page.fill_in 'What you observed', with: 'I am awesome'
  	page.click_button 'Send'
	end

		step 'I should see a success message' do
  	page.should have_content "Thank you for your feedback! We try to respond to questions and requests within one business day."
 		FeedbackForm.last.email.should == 'joe@navigatingcancer.com'
  	FeedbackForm.last.content.should match 'I am awesome'
	end
  	end
</code></pre>

<p>See how much more nicely that reads? Now the user story is really coherent. They go to the form and submit it, and they should get a success message. That&#8217;s truly how simple the step should be. 
Notice that I still handled the validation in Capybara. But the it&#8217;s not the user&#8217;s job to think about what should happen if they don&#8217;t submit the form correctly, it&#8217;s mine. Thus, I should handle that in the test logic that doesn&#8217;t involve the user story.
##Onward##
As a front-end developer coming to the TDD Rails world, Cucumber was helpful to me because it helped me to think about things from the browser&#8217;s perspective. The <a href="https://github.com/cucumber/cucumber/wiki/Gherkin">gherkin syntax</a>, when used well, really does allow for expressive steps and user stories that invite collaboration with non-developers.
But that syntax paired with Capybara&#8217;s more robust step handling make for a much clearer and well-executed test. 
Notably, the reason I went back to this test was that we had changed the UI for the form. Our previous form submitted an <a href="https://unfuddle.com/">unfuddle</a> ticket, but we have recently switched our ticketing system to <a href="http://assembla.com">Assembla</a>. Also, we added a few fields and renamed others. In this case, the Cucumber test (previous to the one I have posted) would have failed because it wouldn&#8217;t have been able to find the form labels it was looking for. <em>But the user story remained the same.</em> All the user wants to do is submit a feedback form. So rather than changing several tests to reflect this, why not only change the ones that are concerned on the back end? They&#8217;re easier to maintain, and as great as Cucumber was, I find that I prefer the Capybara-rspec approach when it comes to looking for content on the page.
I&#8217;m looking forward to exploring this technique across our codebase during refactoring, and in the future. </p>

  

</article>

<section class="recently">
  <h2>Recently</h2>
  <ul class="posts">
    
      <li><span>21 Feb 2013</span> &raquo; <a href="/2013/02/21/coffeescript-wishlist">CoffeeScript Wishlist</a></li>
    
      <li><span>30 Jan 2013</span> &raquo; <a href="/2013/01/30/new-post">Special Characters in Vim</a></li>
    
      <li><span>18 Dec 2012</span> &raquo; <a href="/articles/2012/12/18/method-aliases-in-ruby">Method Aliases In Ruby</a></li>
    
  </ul>
</section>



    </article>
  
    <footer> 
      <p>&copy;<a href='mailto:nick@nickcox.me'>Nick Cox</a> | <a href="http://github.com/thenickcox/">github.com/thenickcox</a> | <a href="http://twitter.com/@everydaytype/">twitter.com/@everydaytype</a><br />
        </p>
    </footer> 
  
  </div><!-- site -->

  
</body>
</html>
